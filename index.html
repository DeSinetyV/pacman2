<!DOCTYPE html>
<html>
  <head>
    <script src="//cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.js"></script>
    <script src="//cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>
  </head>
  <body>
    <script>
      var config = {
        type: Phaser.AUTO,
        width: 607,
        height: 703,
        parent: "phaser-example",
        pixelArt: true,
        backgroundColor: "#1a1a2d",
        scene: {
          preload: preload,
          create: create,
        },
      };

      var game = new Phaser.Game(config);

      function preload() {
        this.load.image("tiles", "assets/drawtiles-spaced.png");
        this.load.image("pacman", "assets/Pacman.png");
        this.load.tilemapCSV("map", "assets/grid.csv");
        this.load.image("ghost1", "assets/Ghost1.png");
        this.load.image("ghost2", "assets/Ghost2.png");
        this.load.image("ghost3", "assets/Ghost3.png");
        this.load.image("ghost4", "assets/Ghost4.png");
      }

      function create() {
        var map = this.make.tilemap({
          key: "map",
          tileWidth: 32,
          tileHeight: 32,
        });
        var tileset = map.addTilesetImage("tiles", null, 32, 32, 1, 2);
        var layer = map.createLayer(0, tileset, 0, 0);

        var player = this.add.image(32 + 16, 32 + 16, "pacman");
        var ghost1 = this.add.image(256 + 16, 320 + 16, "ghost1");
        var ghost2 = this.add.image(288 + 16, 320 + 16, "ghost2");
        var ghost3 = this.add.image(320 + 16, 320 + 16, "ghost3");
        var ghost4 = this.add.image(288 + 16, 288 + 16, "ghost4");



        //  Left

        this.input.keyboard.on("keydown-Q", function (event) {
          var tile = layer.getTileAtWorldXY(player.x - 32, player.y, true);

          if (tile.index === 2) {
            //  Blocked, we can't move
          } else {
            player.x -= 32;
            player.angle = 180;
          }
        });

        this.input.keyboard.on("keydown-LEFT", function (event) {
          var tile = layer.getTileAtWorldXY(player.x - 32, player.y, true);

          if (tile.index === 2) {
            //  Blocked, we can't move
          } else {
            player.x -= 32;
            player.angle = 180;
          }
        });


        //  Right

        this.input.keyboard.on("keydown-D", function (event) {
          var tile = layer.getTileAtWorldXY(player.x + 32, player.y, true);

          if (tile.index === 2) {
            //  Blocked, we can't move
          } else {
            player.x += 32;
            player.angle = 0;
          }
        });

        this.input.keyboard.on("keydown-RIGHT", function (event) {
          var tile = layer.getTileAtWorldXY(player.x + 32, player.y, true);

          if (tile.index === 2) {
            //  Blocked, we can't move
          } else {
            player.x += 32;
            player.angle = 0;
          }
        });


        //  Up

        this.input.keyboard.on("keydown-Z", function (event) {
          var tile = layer.getTileAtWorldXY(player.x, player.y - 32, true);

          if (tile.index === 2) {
            //  Blocked, we can't move
          } else {
            player.y -= 32;
            player.angle = -90;
          }
        });

        this.input.keyboard.on("keydown-UP", function (event) {
          var tile = layer.getTileAtWorldXY(player.x, player.y - 32, true);

          if (tile.index === 2) {
            //  Blocked, we can't move
          } else {
            player.y -= 32;
            player.angle = -90;
          }
        });



        //  Down

        this.input.keyboard.on("keydown-S", function (event) {
          var tile = layer.getTileAtWorldXY(player.x, player.y + 32, true);

          if (tile.index === 2) {
            //  Blocked, we can't move
          } else {
            player.y += 32;
            player.angle = 90;
          }
        });

        this.input.keyboard.on("keydown-DOWN", function (event) {
          var tile = layer.getTileAtWorldXY(player.x, player.y + 32, true);

          if (tile.index === 2) {
            //  Blocked, we can't move
          } else {
            player.y += 32;
            player.angle = 90;
          }
        });
      }
      
    </script>
  </body>
</html>
